<% define_template "rap", jsonmodel_definition(:rap) do |form| %>
  <%= form.label_and_boolean 'open_access_metadata' %>
  <%= form.label_and_select 'access_status', form.possible_options_for("access_status", false) %>
  <%= form.label_and_select 'access_category', form.possible_options_for("access_category", false) %>
  <%
    if form.obj['years']
      form.obj['years'] = form.obj['years'].to_s
    end
  %>
  <%= form.label_and_textfield 'years' %>
  <%= form.label_and_textarea 'change_description' %>
  <%= form.label_and_textfield 'authorised_by' %>
  <%= form.label_and_textfield 'change_date' %>
  <%= form.label_and_textfield 'approved_by' %>
  <%= form.label_and_textfield 'internal_reference' %>

  <% obj = form.obj['attached_to'] %>
  <% if obj %>
    <div class="token-list">
      <% token = render_token :object => obj['_resolved'],
                              :label => obj['_resolved']['display_string'] || obj['_resolved']['title'] || obj['_resolved']['name'],
                              :type => obj['_resolved']['jsonmodel_type'],
                              :uri => obj["ref"],
                              :placement => "top",
                              :inside_linker_browse => true %>

      <%= form.label_with_field "attached_to", token %>
    </div>
  <% end %>
<% end %>