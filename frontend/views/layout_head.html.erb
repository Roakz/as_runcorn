<% if controller_supports_current_record? && current_record.respond_to?(:registration_state) &&
      controller.action_name == 'show' &&
      current_record.registration_state != 'approved' && user_can?('update_agent_record') %>
  <%= stylesheet_link_tag "#{AppConfig[:frontend_proxy_prefix]}assets/managed_registration.css" %>

  <%= javascript_include_tag 'registration_action_dropdown' %>

  <script>
     REGISTRATION_STATE = '<%=j current_record.registration_state %>';
     REGISTRATION_ACTION_DROPDOWN = $('<%=j render_aspace_partial :partial => "shared/registration_action_dropdown", :locals => {:state => current_record.registration_state} %>');
  </script>
<% end %>

<%= stylesheet_link_tag "#{AppConfig[:frontend_proxy_prefix]}assets/runcorn.css" %>


<script type="text/template" id="managedRegistrationButtonTemplate">
  <%= link_to I18n.t("managed_registration.button_label"), {:controller => :managed_registration, :action => :index} %>
</script>

<script type="text/template" id="chargeableItemButtonTemplate">
  <%= link_to I18n.t("chargeable_item.button_label"), {:controller => :chargeable_items, :action => :index} %>
</script>

<script type="text/template" id="chargeableServiceButtonTemplate">
  <%= link_to I18n.t("chargeable_service.button_label"), {:controller => :chargeable_services, :action => :index} %>
</script>

<script type="text/template" id="browseRepresentationsTemplate">
  <li><%= link_to I18n.t("representation._plural"), {:controller => :representations, :action => :index} %></li>
</script>

<script>
    // put link in the System menu
    $(function() {
      var setupButton = function(templ, divider) {
        if (divider) {
          $('.system-menu .dropdown-menu').append($('<li class="divider" />'));
        }
        $but = $(AS.renderTemplate(templ));
        $('.system-menu .dropdown-menu').append($('<li />').append($but));
        $('.system-menu').show();
      };

      setupButton("managedRegistrationButtonTemplate", true);
      setupButton("chargeableItemButtonTemplate", true);
      setupButton("chargeableServiceButtonTemplate");

      // Put representation browse in Repo menu
      $('.repository-header .navbar-nav .browse-container .dropdown-menu .divider:first').before(AS.renderTemplate("browseRepresentationsTemplate"))
    });
</script>


<%= stylesheet_link_tag "#{AppConfig[:frontend_proxy_prefix]}assets/qsa_id.css" %>

<%= javascript_include_tag 'runcorn_tree_toolbar_ext' %>
<%= javascript_include_tag 'runcorn_agency_form' %>
<%= javascript_include_tag 'runcorn_see_no_digital_objects' %>
<%= javascript_include_tag 'runcorn_representation_files' %>


<% if controller_supports_current_record? && current_record && current_record.jsonmodel_type == 'resource' %>
  <%= javascript_include_tag 'runcorn_deaccessions' %>
  <script>
    $(function() {
        $(document).on('loadedrecordform.aspace', function(event, $container) {
            $('section[data-object-name="deaccession"].subrecord-form', $container).each(function() {
                new RuncornDeaccessionSubrecord($(this));
            })
        });
        $(document).on('subrecordcreated.aspace', function(event, subrecord_name, $container) {
            if (subrecord_name == 'digital_representation' || subrecord_name == 'physical_representation') {
                $('section[data-object-name="deaccession"].subrecord-form', $container).each(function() {
                    new RuncornDeaccessionSubrecord($(this));
                });
            }
        });
    });
  </script>
  <script type="text/template" id="runcornDeaccessionWorkflowTemplate">
    <div>
      <div class="modal-body">
        <div class="alert alert-warning">
          <p>Please be aware that deaccessioning this record will also deaccession any child records and linked representations.</p>
          <p>Any physical representations will also be removed from their container.</p>
        </div>
        <p>Affected records include:</p>
        <div class="affected-deaccession-records"><span class="text-muted">Loading...</span></div>
      </div>
      <div class="modal-footer">
        <button id="confirmDeaccessionButton" class="btn btn-warning">Add Deaccession Record</button>
        <button class="btn btn-cancel btn-default" data-dismiss="modal"><%= I18n.t "actions.cancel" %></button>
      </div>
    </div>
  </script>
<% end %>


<%# Accession records aren't used.  Remove them from the Browse & Create menus %>
<script>
 $(function () {
   $('.repository-header .navbar-nav .browse-container .dropdown-menu a').each(function () {
     if ($(this).text() === 'Accessions') {
       this.remove();
     }
   });

   $('.repository-header .navbar-nav .create-container .dropdown-menu a').each(function () {
     if ($(this).text() === 'Accession') {
       this.remove();
     }
   });


 });
</script>

<% if controller_supports_current_record? && current_record && current_record.jsonmodel_type == 'resource' && controller.action_name == 'show' %>
  <%= javascript_include_tag 'runcorn_raps' %>
  <script type="text/template" id="runcornRAPAttachWorkflowTemplate">
    <div>
      <div class="modal-body">
        Loading...
      </div>
      <div class="modal-footer">
        <button id="confirmRAPAttachButton" class="btn btn-primary" disabled>Attach and Apply RAP</button>
        <button class="btn btn-cancel btn-default" data-dismiss="modal"><%= I18n.t "actions.cancel" %></button>
      </div>
    </div>
  </script>
  <script>
    $(document).on('loadedrecordform.aspace', function(event, $container) {
        new RuncornRAPs($container);
    });
  </script>
<% end %>